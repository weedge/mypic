<mxfile host="app.diagrams.net" modified="2021-12-09T03:37:55.574Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36" etag="tyDAPZVGHu3JvCds4MmO" version="15.8.6" type="github">
  <diagram id="FWJPGezK9j8gdbF37r2M" name="Page-1">
    <mxGraphModel dx="946" dy="603" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="SzUL2O4MbR3VGQP7T_4b-2" value="" style="shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image=https://www.nginx.com/wp-content/uploads/2016/07/thread-pools-worker-process-event-cycle.png;" vertex="1" parent="1">
          <mxGeometry x="80" y="210" width="676.42" height="320" as="geometry" />
        </mxCell>
        <mxCell id="SzUL2O4MbR3VGQP7T_4b-3" value="---with-threads配置参数编译，才能使用, 使用场景是worker进程是单线程的，如果单线程处理的任务存在阻塞影响吞吐，&lt;br style=&quot;font-size: 13px&quot;&gt;比如磁盘io read,sendfile 大量文件操作时，可以使用，根据磁盘数以及硬件开启多个thread_pool 进行专门调优，参数：&lt;br style=&quot;font-size: 13px&quot;&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;# in the &#39;main&#39; context&lt;/div&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;thread_pool default threads=32 max_queue=65536;&lt;/div&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;# in the &#39;http&#39;, &#39;server&#39;, or &#39;location&#39; context&lt;/div&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;aio threads=default;&lt;/div&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;max_queue&amp;nbsp;满了，直接报错，而不是放入发送等待队列中等待，&lt;/div&gt;&lt;div style=&quot;font-size: 13px&quot;&gt;这就需要worker进程配置threads加大处理，而不是动态伸缩扩容，可能有性能影响考虑吧&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=13;fontColor=#5A687D;fontStyle=0" vertex="1" parent="1">
          <mxGeometry x="64" y="640" width="700" height="130" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
